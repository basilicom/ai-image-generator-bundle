/*! For license information please see backend.js.LICENSE.txt */
"use strict";(self.webpackChunkbasilicom_ai_image_generator_bundle=self.webpackChunkbasilicom_ai_image_generator_bundle||[]).push([[154],{282:(e,t,n)=>{n(985),n(71),n(992),n(704),n(876),n(474)},985:(e,n,r)=>{r.r(n);var o=r(556),i=r(844),a=r(695);document.addEventListener(pimcore.events.postOpenAsset,(function(e){if(a.Z.isFeatureEnabled(i.Z.INPAINT_BACKGROUND)){var n=e.detail.asset,r=t("Generate Background"),u=t("Generating background ...");n.toolbar.insert(3,{text:r,scale:"medium",handler:function(e,t){new o.Z(e,i.Z.INPAINT_BACKGROUND).getWindow((function(){t.setText(u)}),(function(){e.reload()}),(function(){t.setText(r)})).show()}.bind(undefined,n)}),pimcore.layout.refresh()}}))},71:(e,n,r)=>{r.r(n);var o=r(844),i=r(695),a=r(63);function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _toPropertyKey(e){var t=function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===_typeof(t)?t:String(t)}var u,l,c,s,d,f,p,y,m,g,h=function(){function InpaintingWindow(e){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,InpaintingWindow),function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}(this,"asset",void 0),this.asset=e}return function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(InpaintingWindow,[{key:"getWindow",value:function getWindow(e,n,r){return Ext.create("AiImageGeneratorBundle.view.CanvasWindow",{asset:this.asset,onRequest:e,onSuccess:n,onError:function onError(e){pimcore.helpers.showNotification(t("error"),e.message,"error")},onDone:r})}}]),InpaintingWindow}(),v=!1,b=5,w=function receiveMaskImage(){var e=document.createElement("canvas");return e.width=s,e.height=d,e.getContext("2d").fillStyle="white",e.getContext("2d").fillRect(0,0,s,d),e.getContext("2d").drawImage(y,f,p,s,d,0,0,s,d),_(e)},_=function getImage(e){for(var t=e.toDataURL("image/jpeg",1),n=atob(t.split(",")[1]),r=t.split(",")[0].split(":")[1].split(";")[0],o=new ArrayBuffer(n.length),i=new Uint8Array(o),a=0;a<n.length;a++)i[a]=n.charCodeAt(a);return new Blob([o],{type:r})},I=function drawBackground(e){var t=e.width/e.height>y.width/y.height?y.width/e.width:y.height/e.height,n=(y.width-e.width*t)/2,r=(y.height-e.height*t)/2;s=e.width*t,d=e.height*t,f=n,p=r,l.getContext("2d").drawImage(e,n,r,e.width*t,e.height*t),c=e};Ext.define("AiImageGeneratorBundle.view.CanvasWindow",{extend:"Ext.Window",xtype:"canvaswindow",title:"Inpainting",width:1024,height:1244,layout:"fit",modal:!0,closable:!0,config:{asset:null,onRequest:function onRequest(){},onSuccess:function onSuccess(){},onError:function onError(){},onDone:function onDone(){}},initComponent:function initComponent(){var e;u=this.getAsset();var n=null!==(e=window.localStorage.getItem("prompt"))&&void 0!==e?e:"",r=this.getOnRequest(),o=(this.getOnSuccess(),this.getOnError()),i=this.getOnDone(),h=new Image;h.src=u.data.url,this.items=[{xtype:"container",items:[{xtype:"component",itemId:"canvasContainer",width:"100%",height:1024,listeners:{afterrender:function afterrender(){(y=document.createElement("canvas")).width=1024,y.height=1024,y.style.position="relative",y.style.opacity=.7,y.style.zIndex=10,(l=y.cloneNode(!0)).style.position="absolute",l.style.top=0,l.style.left=0,l.style.zIndex=5,l.style.pointerEvents="none",l.style.borderTop="1px solid #000",l.style.borderBottom="1px solid #000",l.style.opacity=1,l.style.background="#fff",this.getEl().dom.appendChild(l),this.getEl().dom.appendChild(y),y.addEventListener("mousedown",(function(e){v=!0,b=Ext.getCmp("ai_image_generator_bundle_line_width_slider").getValue(),m=e.offsetX,g=e.offsetY})),y.addEventListener("mousemove",(function(e){if(v){var t=e.offsetX,n=e.offsetY;!function drawLine(e,t,n,r){var o=y.getContext("2d");o.beginPath(),o.strokeStyle="#000000",o.lineWidth=b,o.lineCap="round",o.moveTo(e,t),o.lineTo(n,r),o.stroke(),o.closePath()}(m,g,t,n),m=t,g=n}})),y.addEventListener("mouseup",(function(){var e=y.getContext("2d");v=!1,e.beginPath()})),h.onload=function(){I(h)}}}},{xtype:"textareafield",itemId:"prompt",name:"prompt",value:n,grow:!0,width:"calc(100% - 20px)",fieldLabel:t("Prompt"),padding:"10"}]}],this.buttons=[{text:t("cancel"),iconCls:"pimcore_icon_cancel",handler:function handler(){this.up("window").close()}},{text:t("Generate"),handler:function handler(){var e=this.up("window").down("#prompt").getValue();window.localStorage.setItem("prompt",e);var t=this.up("window").down("#confirmButton"),n=this;a.Z.inpaintImage({id:u.id,prompt:e,mask:w(),draft:!0},(function(){t.setDisabled(!0),n.setDisabled(!0)}),(function(e){t.setDisabled(!1);var n=new Image;n.src="data:image/png;base64,"+e.image,n.onload=function(){I(n)}}),(function(){}),(function(){n.setDisabled(!1)}))}},{text:t("apply"),iconCls:"pimcore_icon_apply",id:"confirmButton",disabled:!0,handler:function handler(){var e=this,t=this.up("window").down("#prompt").getValue();window.localStorage.setItem("prompt",t);var n=document.createElement("canvas");n.width=s,n.height=d,n.getContext("2d").drawImage(l,f,p,s,d,0,0,s,d);var c=_(n);a.Z.save({id:u.id,data:c},r,(function(){u.data.url=c,u.reload(),e.up("window").close()}),o,i)}}],this.tbar=[{text:"Clear",handler:function handler(){y.getContext("2d").clearRect(0,0,y.width,y.height),I(c)}},{xtype:"slider",fieldLabel:"Line Width",width:500,minValue:5,maxValue:50,value:20,id:"ai_image_generator_bundle_line_width_slider"}],this.callParent(arguments)}});document.addEventListener(pimcore.events.postOpenAsset,(function(e){if(i.Z.isFeatureEnabled(o.Z.INPAINT)){var n=e.detail.asset,r=t("Inpaint"),a=t("Generating in progress ...");n.toolbar.insert(3,{text:r,scale:"medium",handler:function(e,t){new h(e).getWindow((function(){t.setText(a)}),(function(){e.reload()}),(function(){t.setText(r)})).show()}.bind(undefined,n)}),pimcore.layout.refresh()}}))},992:(e,n,r)=>{r.r(n);var o=r(63),i=r(844),a=r(695);document.addEventListener(pimcore.events.postOpenAsset,(function(e){if(a.Z.isFeatureEnabled(i.Z.UPSCALE)){var n=e.detail.asset,r=t("Upscale"),u=t("Upscaling in progress ..."),l=n.data.customSettings.imageWidth<4096&&n.data.customSettings.imageHeight<4096;n.toolbar.insert(3,{text:r,scale:"medium",disabled:!l,tooltip:l?null:t("Upscaling is only possible up to 4096 pixels."),handler:function(e,n){o.Z.upscaleImage({id:e.id},(function(){n.setText(u),n.setDisabled(!0)}),(function(t){e.reload()}),(function(e){pimcore.helpers.showNotification(t("error"),e.message,"error")}),(function(){n.setDisabled(!l),n.setText(r)}))}.bind(undefined,n)}),pimcore.layout.refresh()}}))},704:(e,n,r)=>{r.r(n);var o=r(556),i=r(844),a=r(695);document.addEventListener(pimcore.events.postOpenAsset,(function(e){if(a.Z.isFeatureEnabled(i.Z.IMAGE_VARIATIONS)){var n=e.detail.asset,r=t("Vary image"),u=t("Generating in progress ...");n.toolbar.insert(3,{text:r,scale:"medium",handler:function(e,t){new o.Z(e,i.Z.IMAGE_VARIATIONS).getWindow((function(){t.setText(u)}),(function(){e.reload()}),(function(){t.setText(r)})).show()}.bind(undefined,n)}),pimcore.layout.refresh()}}))},63:(e,t,n)=>{function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(o=r.key,i=void 0,i=function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===_typeof(i)?i:String(i)),r)}var o,i}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function define(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function define(e,t,n){return e[t]=n}}function wrap(e,t,n,o){var i=t&&t.prototype instanceof Generator?t:Generator,a=Object.create(i.prototype),u=new Context(o||[]);return r(a,"_invoke",{value:makeInvokeMethod(e,n,u)}),a}function tryCatch(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=wrap;var l={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var c={};define(c,i,(function(){return this}));var s=Object.getPrototypeOf,d=s&&s(s(values([])));d&&d!==t&&n.call(d,i)&&(c=d);var f=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(c);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,i,a){var u=tryCatch(e[r],e,o);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==_typeof(c)&&n.call(c,"__await")?t.resolve(c.__await).then((function(e){invoke("next",e,i,a)}),(function(e){invoke("throw",e,i,a)})):t.resolve(c).then((function(e){l.value=e,i(l)}),(function(e){return invoke("throw",e,i,a)}))}a(u.arg)}var o;r(this,"_invoke",{value:function value(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return o=o?o.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,t,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return doneResult()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var u=maybeInvokeDelegate(a,n);if(u){if(u===l)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=tryCatch(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function maybeInvokeDelegate(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,maybeInvokeDelegate(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),l;var o=tryCatch(r,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,l;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function next(){for(;++r<e.length;)if(n.call(e,r))return next.value=e[r],next.done=!1,next;return next.value=void 0,next.done=!0,next};return o.next=o}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,r(f,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),r(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,u,"GeneratorFunction")),e.prototype=Object.create(f),e},e.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,a,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},defineIteratorMethods(f),define(f,u,"Generator"),define(f,i,(function(){return this})),define(f,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function next(){for(;n.length;){var e=n.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function stop(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var t=this;function handle(n,r){return i.type="throw",i.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],i=o.completion;if("root"===o.tryLoc)return handle("end");if(o.tryLoc<=this.prev){var a=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(a&&u){if(this.prev<o.catchLoc)return handle(o.catchLoc,!0);if(this.prev<o.finallyLoc)return handle(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return handle(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return handle(o.finallyLoc)}}}},abrupt:function abrupt(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function complete(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function finish(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),resetTryEntry(n),l}},catch:function _catch(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;resetTryEntry(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(e,t,n){return this.delegate={iterator:values(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},e}function asyncGeneratorStep(e,t,n,r,o,i,a){try{var u=e[i](a),l=u.value}catch(e){return void n(e)}u.done?t(l):Promise.resolve(l).then(r,o)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function _next(e){asyncGeneratorStep(i,r,o,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(i,r,o,_next,_throw,"throw",e)}_next(void 0)}))}}n.d(t,{Z:()=>i});var r=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(){var e,t,n,r=arguments;return _regeneratorRuntime().wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:return e=r.length>0&&void 0!==r[0]?r[0]:"",t=r.length>1&&void 0!==r[1]?r[1]:{},o.next=4,fetch(e,{method:"POST",body:JSON.stringify(t)});case 4:return n=o.sent,o.abrupt("return",n.json());case 6:case"end":return o.stop()}}),_callee2)})));return function POST(){return e.apply(this,arguments)}}(),o=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(){var e,t,n,r,o,i=arguments;return _regeneratorRuntime().wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:for(r in e=i.length>0&&void 0!==i[0]?i[0]:"",t=i.length>1&&void 0!==i[1]?i[1]:{},n=new FormData,t)n.append(r,t[r]);return a.next=6,fetch(e,{method:"POST",body:n});case 6:return o=a.sent,a.abrupt("return",o.json());case 8:case"end":return a.stop()}}),_callee3)})));return function FORMPOST(){return e.apply(this,arguments)}}();const i=new(function(){function AiImageGenerator(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,AiImageGenerator)}return function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(AiImageGenerator,[{key:"generateAiImageByContext",value:function generateAiImageByContext(e,t,n,o,i){var a=Routing.generate("ai_image_by_element_context",e);t(),r(a,e).then((function(e){!0===e.success?n(e):o(e)})).finally((function(){i()}))}},{key:"upscaleImage",value:function upscaleImage(e,t,n,o,i){var a=Routing.generate("ai_image_upscale",e);t(),r(a,e).then((function(e){!0===e.success?n(e):o(e)})).finally((function(){i()}))}},{key:"inpaintImage",value:function inpaintImage(e,t,n,r,i){var a=Routing.generate("ai_image_inpaint",{id:e.id});t(),o(a,e).then((function(e){!0===e.success?n(e):r(e)})).finally((function(){i()}))}},{key:"save",value:function save(e,t,n,r,i){var a=Routing.generate("ai_image_save",{id:e.id});t(),o(a,e).then((function(e){!0===e.success?n(e):r(e)})).finally((function(){i()}))}},{key:"varyImage",value:function varyImage(e,t,n,o,i){var a=Routing.generate("ai_image_vary",e);t(),r(a,e).then((function(e){!0===e.success?n(e):o(e)})).finally((function(){i()}))}},{key:"inpaintBackground",value:function inpaintBackground(e,t,n,o,i){var a=Routing.generate("ai_image_inpaint_background",e);t(),r(a,e).then((function(e){!0===e.success?n(e):o(e)})).finally((function(){i()}))}}]),AiImageGenerator}())},556:(e,n,r)=>{r.d(n,{Z:()=>u});var o=r(63),i=r(844),a=r(695);function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _toConsumableArray(e){return function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}(e)||function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function _unsupportedIterableToArray(e,t){if(!e)return;if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(e,t)}(e)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===_typeof(t)?t:String(t)}var u=function(){function SimpleImage2ImageWindow(e,t){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,SimpleImage2ImageWindow),_defineProperty(this,"asset",void 0),_defineProperty(this,"context",void 0),this.asset=e,this.context=t}return function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(SimpleImage2ImageWindow,[{key:"getWindow",value:function getWindow(e,n,r){var u,l,c=null!==(u=window.localStorage.getItem("prompt"))&&void 0!==u?u:"",s=this.asset.data.metadata.hasOwnProperty("prompt~")?this.asset.data.metadata["prompt~"].data:c,d=this.asset.data.metadata.hasOwnProperty("seed~")?this.asset.data.metadata["seed~"].data:-1,f=null!==(l=window.localStorage.getItem("branding"))&&void 0!==l&&l,p=[{xtype:"textareafield",itemId:"prompt",name:"prompt",value:s,grow:!0,width:"100%",fieldLabel:t("Prompt"),tooltip:"<i>"+t("Leave empty to create prompt from various properties.")+"</i>"},{xtype:"tbtext",fieldLabel:"",text:"<i>"+t("Leave empty to create prompt automatically.")+"</i>",scale:"small",padding:"0 0 20 105",width:"100%"}];a.Z.isSeedingSupported(this.context)&&(p=[].concat(_toConsumableArray(p),[{xtype:"numberfield",name:"seed",value:d,itemId:"seed",width:"100%",fieldLabel:t("Seed")}])),this.context===i.Z.INPAINT_BACKGROUND&&(p=[].concat(_toConsumableArray(p),[{xtype:"checkbox",itemId:"branding",name:"branding",checked:f,fieldLabel:t("Branding")}]));var y=new Ext.Window({title:t("Generate image"),width:400,bodyStyle:"padding: 10px;",closable:!1,plain:!0,items:p,buttons:[{text:t("cancel"),iconCls:"pimcore_icon_cancel",handler:function handler(){y.close()}},{text:t("apply"),iconCls:"pimcore_icon_apply",handler:function(){var a=y.getComponent("prompt").getValue(),u=y.getComponent("seed")?y.getComponent("seed").getValue():-1;window.localStorage.setItem("prompt",a),window.localStorage.setItem("seed",u);var l={id:this.asset.id,prompt:a,seed:u};if(y.getComponent("branding")){var c=y.getComponent("branding").getValue();window.localStorage.setItem("branding",c),l.brand=c}var s=function extendedOnRequest(){e(),y.close()},d=function onError(e){pimcore.helpers.showNotification(t("error"),e.message,"error")};this.context===i.Z.IMAGE_VARIATIONS?o.Z.varyImage(l,s,n,d,r):this.context===i.Z.INPAINT_BACKGROUND&&o.Z.inpaintBackground(l,s,n,d,r)}.bind(this)}]});return y}}]),SimpleImage2ImageWindow}()},778:(e,n,r)=>{r.d(n,{Z:()=>l});var o=new Ext.data.Store({fields:["key","value"],data:[{key:"16:9",value:"16:9"},{key:"4:3",value:"4:3"},{key:"3:2",value:"3:2"},{key:"16:10",value:"16:10"},{key:"5:4",value:"5:4"},{key:"1:1",value:"1:1"},{key:"21:9",value:"21:9"}]}),i=r(63),a=r(695),u=r(844);function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _toConsumableArray(e){return function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}(e)||function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function _unsupportedIterableToArray(e,t){if(!e)return;if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(e,t)}(e)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===_typeof(t)?t:String(t)}var l=function(){function SimpleText2ImageWindow(e,t){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,SimpleText2ImageWindow),_defineProperty(this,"id",void 0),_defineProperty(this,"context",void 0),this.id=e,this.context=t}return function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(SimpleText2ImageWindow,[{key:"getWindow",value:function getWindow(e,n,r){var l,c,s=null!==(l=window.localStorage.getItem("prompt"))&&void 0!==l?l:"",d=null!==(c=window.localStorage.getItem("branding"))&&void 0!==c&&c,f=[{xtype:"textareafield",itemId:"prompt",name:"prompt",value:s,grow:!0,width:"100%",fieldLabel:t("Prompt"),tooltip:"<i>"+t("Leave empty to create prompt from various properties.")+"</i>"},{xtype:"tbtext",fieldLabel:"",text:"<i>"+t("Leave empty to create prompt automatically.")+"</i>",scale:"small",padding:"0 0 20 105",width:"100%"},{xtype:"checkbox",itemId:"branding",name:"branding",checked:d,fieldLabel:t("Branding")}];if(a.Z.isAspectRatioSupported(u.Z.TXT2IMG)){var p;o.load();var y=null!==(p=window.localStorage.getItem("aspectRatio"))&&void 0!==p?p:"1:1";f=[{xtype:"combobox",itemId:"aspectRatio",name:"aspectRatio",triggerAction:"all",selectOnFocus:!0,fieldLabel:t("Aspect Ratio"),store:o,value:y,displayField:"key",valueField:"value",width:"100%"}].concat(_toConsumableArray(f))}if(a.Z.isSeedingSupported(u.Z.TXT2IMG)){var m,g=null!==(m=window.localStorage.getItem("seed"))&&void 0!==m?m:-1;f=[].concat(_toConsumableArray(f),[{xtype:"numberfield",name:"seed",value:g,itemId:"seed",width:"100%",fieldLabel:t("Seed")}])}var h=new Ext.Window({title:t("Generate image"),width:400,bodyStyle:"padding: 10px;",closable:!1,plain:!0,items:f,buttons:[{text:t("cancel"),iconCls:"pimcore_icon_cancel",handler:function handler(){h.close()}},{text:t("apply"),iconCls:"pimcore_icon_apply",handler:function(){var o=h.getComponent("prompt").getValue();window.localStorage.setItem("prompt",o);var l=h.getComponent("branding").getValue();window.localStorage.setItem("branding",l);var c={context:this.context,id:this.id,prompt:o,brand:l};if(a.Z.isAspectRatioSupported(u.Z.TXT2IMG)){var s=h.getComponent("aspectRatio").getValue();window.localStorage.setItem("aspectRatio",s),c.aspectRatio=s}if(a.Z.isSeedingSupported(u.Z.TXT2IMG)){var d=h.getComponent("seed")?h.getComponent("seed").getValue():-1;window.localStorage.setItem("seed",d),c.seed=d}i.Z.generateAiImageByContext(c,(function(){e(),h.close()}),(function(e){n(e)}),(function(e){pimcore.helpers.showNotification(t("error"),e.message,"error")}),(function(){r()}))}.bind(this)}]});return h}}]),SimpleText2ImageWindow}()},844:(e,t,n)=>{n.d(t,{Z:()=>r});const r={TXT2IMG:"txt2img",UPSCALE:"upscale",INPAINT:"inpaint",INPAINT_BACKGROUND:"inpaint_background",IMAGE_VARIATIONS:"image_variations"}},695:(e,t,n)=>{function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(o=r.key,i=void 0,i=function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===_typeof(i)?i:String(i)),r)}var o,i}n.d(t,{Z:()=>s});var r=function storage(){return pimcore.settings.AiImageGeneratorBundle||{}};const o=new(function(){function ConfigStorage(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,ConfigStorage)}return function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(ConfigStorage,[{key:"set",value:function set(e,t){r()[e]=t}},{key:"get",value:function get(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return r()[e]||t}}]),ConfigStorage}()),i="OpenAi",a="DreamStudio",u="StableDiffusion",l="ClipDrop";var c=n(844);function FeatureHelper_typeof(e){return FeatureHelper_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},FeatureHelper_typeof(e)}function FeatureHelper_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(o=r.key,i=void 0,i=function FeatureHelper_toPrimitive(e,t){if("object"!==FeatureHelper_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==FeatureHelper_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===FeatureHelper_typeof(i)?i:String(i)),r)}var o,i}const s=new(function(){function FeatureHelper(){!function FeatureHelper_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,FeatureHelper)}return function FeatureHelper_createClass(e,t,n){return t&&FeatureHelper_defineProperties(e.prototype,t),n&&FeatureHelper_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(FeatureHelper,[{key:"isFeatureEnabled",value:function isFeatureEnabled(e){var t=o.get("adapter",null);switch(t?t[e]:null){case u:switch(e){case c.Z.TXT2IMG:case c.Z.UPSCALE:case c.Z.INPAINT:case c.Z.INPAINT_BACKGROUND:case c.Z.IMAGE_VARIATIONS:return!0;default:return!1}case a:switch(e){case c.Z.TXT2IMG:case c.Z.UPSCALE:case c.Z.INPAINT:case c.Z.INPAINT_BACKGROUND:case c.Z.IMAGE_VARIATIONS:return!0;default:return!1}case i:switch(e){case c.Z.TXT2IMG:case c.Z.INPAINT:case c.Z.INPAINT_BACKGROUND:case c.Z.IMAGE_VARIATIONS:return!0;default:return!1}case l:switch(e){case c.Z.TXT2IMG:case c.Z.UPSCALE:case c.Z.INPAINT_BACKGROUND:case c.Z.IMAGE_VARIATIONS:return!0;default:return!1}default:return!1}}},{key:"isSeedingSupported",value:function isSeedingSupported(e){var t=o.get("adapter",null),n=t?t[e]:null;return n===u||n===a}},{key:"isAspectRatioSupported",value:function isAspectRatioSupported(e){var t=o.get("adapter",null),n=t?t[e]:null;return e===c.Z.TXT2IMG&&n!==l}}]),FeatureHelper}())},474:(e,n,r)=>{r.r(n);var o=r(778),i=r(844),a=r(695);pimcore.registerNS("pimcore.object.tags.hotspotimage"),pimcore.object.tags.hotspotimage=Class.create(pimcore.object.tags.hotspotimage,{label:"Generate Image",button:null,getLayoutEdit:function getLayoutEdit($super){var e=$super();if(!a.Z.isFeatureEnabled(i.Z.TXT2IMG))return e;var n=e.getDockedItems("toolbar")[0];return this.button=new Ext.button.Button({text:t(this.label),handler:this.generateAiImage.bind(this)}),n.add(this.button),e},generateAiImage:function generateAiImage(){var e=this,n=this.component.body.dom;new o.Z(this.context.objectId,"object").getWindow((function(){n.classList.add("ai-image-loader"),e.button.innerHTML=t("Loading...")}),(function(t){e.empty(!0),e.data.id!==t.id&&(e.dirty=!0),e.data.id=t.id,e.updateImage()}),(function(){n.classList.remove("ai-image-loader"),e.button.innerHTML=t(e.label)})).show()}})},876:(e,n,r)=>{r.r(n);var o=r(778),i=r(844),a=r(695);pimcore.registerNS("pimcore.object.tags.image"),pimcore.object.tags.image=Class.create(pimcore.object.tags.image,{label:"Generate Image",button:null,getLayoutEdit:function getLayoutEdit($super){var e=$super();if(!a.Z.isFeatureEnabled(i.Z.TXT2IMG))return e;var n=e.getDockedItems("toolbar")[0];return this.button=new Ext.button.Button({text:t(this.label),handler:this.generateAiImage.bind(this)}),n.add(this.button),e},generateAiImage:function generateAiImage(){var e=this,n=this.component.body.dom;new o.Z(this.context.objectId,"object").getWindow((function(){n.classList.add("ai-image-loader"),e.button.innerHTML=t("Loading...")}),(function(t){e.empty(!0),e.data.id!==t.id&&(e.dirty=!0),e.data.id=t.id,e.updateImage()}),(function(){n.classList.remove("ai-image-loader"),e.button.innerHTML=t(e.label)})).show()}})}},e=>{var t;t=282,e(e.s=t)}]);